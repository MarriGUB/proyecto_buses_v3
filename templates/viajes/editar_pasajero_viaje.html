{% extends 'base.html' %}

{% block title %}Editar Pasajero en Viaje - Sistema de Gestión de Flota{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Editar Información del Pasajero</h2>
    <div>
        <a href="{% url 'viajes:viaje_pasajeros' viaje.pk %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Volver
        </a>
    </div>
</div>

<!-- Información del Viaje y Pasajero -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <i class="fas fa-bus me-2"></i>Información del Viaje
            </div>
            <div class="card-body">
                <p><strong>Bus:</strong> {{ viaje.bus.placa }} - {{ viaje.bus.modelo }}</p>
                <p><strong>Ruta:</strong> {{ viaje.lugar_origen.nombre }} → {{ viaje.lugar_destino.nombre }}</p>
                <p><strong>Fecha:</strong> {{ viaje.fecha_salida|date:"d/m/Y H:i" }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-info text-white">
                <i class="fas fa-user me-2"></i>Información del Pasajero
            </div>
            <div class="card-body">
                <p><strong>Nombre:</strong> {{ pasajero.nombre_completo }}</p>
                <p><strong>RUT:</strong> {{ pasajero.rut }}</p>
                <p><strong>Teléfono:</strong> {{ pasajero.numero_telefono|default:"-" }}</p>
                <p><strong>Correo:</strong> {{ pasajero.correo|default:"-" }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Formulario de Edición -->
<div class="card">
    <div class="card-header bg-warning text-dark">
        <i class="fas fa-edit me-2"></i>Editar Información en el Viaje
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="asiento" class="form-label">Número de Asiento</label>
                        <input type="text" 
                               name="asiento" 
                               id="asiento" 
                               class="form-control" 
                               value="{{ viaje_pasajero.asiento|default:'' }}" 
                               placeholder="Ej: 12A, 5B, etc.">
                        <div class="form-text">Opcional: Ingrese el número o código del asiento asignado.</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="observaciones" class="form-label">Observaciones</label>
                        <textarea name="observaciones" 
                                  id="observaciones" 
                                  class="form-control" 
                                  rows="3" 
                                  placeholder="Observaciones adicionales sobre este pasajero en el viaje">{{ viaje_pasajero.observaciones|default:'' }}</textarea>
                        <div class="form-text">Opcional: Cualquier información adicional sobre este pasajero.</div>
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Registro:</strong> Este pasajero fue agregado al viaje el {{ viaje_pasajero.fecha_registro|date:"d/m/Y a las H:i" }}.
                </div>
            </div>
            
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-warning">
                    <i class="fas fa-save me-2"></i>Guardar Cambios
                </button>
                <a href="{% url 'viajes:viaje_pasajeros' viaje.pk %}" class="btn btn-secondary">
                    <i class="fas fa-times me-2"></i>Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

<!-- Información adicional -->
<div class="mt-4">
    <div class="row">
        <div class="col-md-4">
            <div class="card border-success">
                <div class="card-body text-center">
                    <i class="fas fa-users fa-2x text-success mb-2"></i>
                    <h6 class="card-title">Total Pasajeros</h6>
                    <h4 class="text-success">{{ viaje.get_pasajeros_count }}</h4>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-info">
                <div class="card-body text-center">
                    <i class="fas fa-chair fa-2x text-info mb-2"></i>
                    <h6 class="card-title">Capacidad Bus</h6>
                    <h4 class="text-info">{{ viaje.bus.capacidad_pasajeros }}</h4>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-warning">
                <div class="card-body text-center">
                    <i class="fas fa-percentage fa-2x text-warning mb-2"></i>
                    <h6 class="card-title">Ocupación</h6>
                    <h4 class="text-warning">{% widthratio viaje.get_pasajeros_count viaje.bus.capacidad_pasajeros 100 %}%</h4>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}